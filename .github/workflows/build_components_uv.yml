# This workflow will build a KivySwiftLink release

name: Build Components with UV


on:

  # workflow_dispatch:
  #   inputs:
  #     tag:
  #       description: 'input new release tag'
  #       required: false
  #       type: string
  #       default: "311.0.0"
  #     lastest:
  #       description: 'lastest release?'
  #       required: false
  #       type: boolean
  #       default: false

  workflow_call:
    inputs:
      tag:
        required: false
        type: string
        default: "311.0.0"
      lastest:
        required: false
        type: boolean
        default: false

jobs:
  toolchainBuild:
    runs-on: macOS-13
    #runs-on: self-hosted
    permissions:
        contents: write
  
    steps:
    #   - uses: maxim-lobanov/setup-xcode@v1
    #     with:
    #       xcode-version: '15.0'
        
      - uses: actions/checkout@v4
      
      - name: setup python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11' # install the python version needed
      
      - name: brew install uv
        run: brew install uv
      
      # - name: clone psbuilder
      #   run: git clone https://github.com/PythonSwiftLink/PSBuilder
      
      # - name: uv sync builder
      #   run: uv sync --no-editable -v
      #   working-directory: builder

      - name: builder generate all
        run: uv run --no-editable --directory builder generate_all.py ${{ github.event.inputs.tag }}
      # - name: build hostpython
      #   run: uv run -v --directory psbuilder psbuilder build hostpython3
      
      # - name: build freetype
      #   run: uv run -v --directory psbuilder psbuilder build freetype

      # - name: build libpng
      #   run: uv run -v --directory psbuilder psbuilder build libpng

      # - name: build libjpeg
      #   run: uv run -v --directory psbuilder psbuilder build libjpeg

      # - name: build python3
      #   run: uv run -v --directory psbuilder psbuilder build python3

      # - name: build kivy
      #   run: uv run -v --directory psbuilder psbuilder build kivy

      # - name: build pillow
      #   run: uv run -v --directory psbuilder psbuilder build pillow

      # - name: build numpy
      #   run: uv run -v --directory psbuilder psbuilder build numpy
      
      # - name: swift_package all
      #   run: uv run -v --directory psbuilder psbuilder swiftpackage all --version ${{ github.event.inputs.tag }}
      
      - name: show root files before uploads
        run: ls
      
      - uses: actions/upload-artifact@v4
        with:
          name: release-output
          path: ./swift_packages

  # ###############################################################################
  # ###############################################################################
  # ###############################################################################
  # #moving next part to an ubuntu machine
